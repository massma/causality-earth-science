\documentclass[12pt]{article}
\input{def}

\begin{document}

\title{Causal inference in earth science}

\author{Adam Massmann\thanks{Corresponding author: akm2203@columbia.edu}}

\maketitle

\begin{abstract}
  Research on the inference of causal effects from data is rapidly
  intensifying, and earth system scientists are applying new causal
  inference methods to a variety of problems. I examine the
  theoretical justification for applying causal inference methods to
  climate science. Because we generally do not fully observe the state
  space of the problem, the assumptions behind generic causal
  inference methods break down. However, by focusing on problems at
  the human-environment interface (e.g. anthropogenic greenhouse gas
  emissions and urban heat island effect), we may be able to
  successfully apply causal inference methods to earth science and
  calculate the causal effects of humans on the environment.

\end{abstract}

\section{Introduction}

% usefullness causal inference e.s.

Causal inference is the estimation of effects (e.g. temperature)
in response to changes in causes (e.g. green house gas
concentration) using observational data from a system. Causal
inference is an alternative path towards scientific discovery,
which traditionally relies on experimentation (e.g. numerical,
lab, or real world) to determine the effect of varying causes. In
earth sciences in particular it may be impossible or unethical to
execute real world experiments, and numerical experiments may rely
on approximations that bias causal estimates relative to the real
world. Given these challenges in earth science, causal inference
from data is a tantilizing tool that allows for robust
estimatation of causal effects that may be otherwise impossible
using traditoinal tools.


% challenges of ci in e.s.}

However, causal inference from data presents its own challenges. A
necessary conditon for calculating a causal effect is that the
causal effect must be identifiable from the set of observable
variables. Whether or not a causal effect is identifiable is
determined from our assumptions about how a system behaves and
which variables we can obtain observations for. If an effect is
determined to be unidentifable, then it is impossible to calculate
the causal effect of interest, even with an infitinte sample of
data. Specific to problems in earth science, the identification of
causal effects is challenging given two fundamental properties of
many generic earth science problems: the system evolves through
time according to an underlying dynamical system, and we only ever
partially observe the state space of that dynamical system. Using
graph theory developed in \citep{pearl1995causal} we determine the
generic problems causal inference is justified for, and the
necesarry assumptions for applyign causal inference. There is the
potential for applying causal inference in two scenarios: (1)
under an assumption that the cause is independent of the (cliamte)
system's state space (e.g. at the human-climate interface,
anthropogenic green house gas emission, land use change) (Secion
xx); and (2) under certain conditions where we can estimate the
state space of the system from using carefully selected time
lagged observations (Section xx).  \emph{discuss relationship to
boundary condition experiments?} Our theoretical results
identifying tractable problems in earth science require a few
fundamentals from the causal inference literature, so we introduce
causal inference theory, causal graphs, and do calculus for the
unfamiliar reader (Section xx), and compare with recent earth
science literature on the related field of causal discovery.

% include this?
% Causal graphs are also a useful general research tool for
% communicating assumptions, whether or not causal inference is actually
% used (Section xx).

\section{Causal graphs and Pearl's do calculus}

% intro causal graphs}

Causal graphs, introduced in \citep{pearl1995causal}, are directed
acyclic graphs (DAGs) that encode our assumptions about the causal
dependencies of a system. One draws directed edges (e.g. arrows)
from variables that are causes to effects. To illustrate, in a
simplified toy example examing clouds, aerosols, and surface solar
radiation, we would draw (Figure xx):

\begin{enumerate}
\item An edge from aerosols to clouds because aerosols serve as cloud
condensation nuclei.
\item An edge from aerosols to surface solar radiation, because
aerosols can reflect sunlight back to space and reduce sunlight
at the surface.
\item An edge from clouds to surface solar ratiation, because clouds
also reflect sunlight back to space and can reduce sunlight at
the surface.
\end{enumerate}

Causal graphs encode our assumptions about how the system behaves,
and the nodes and edges that are missing from the graph often
represent strong assumptions about how the system works. For
example, in the cloud-aerosol-sunlight example, clouds also affect
aerosols by increasing the likelihood that aerosol will be scoured
from the atmosphere during precipitatation. By not including an
edge from cloud to aerosol, we are making a strong assumption that
we are ignoring this effect of clouds on aerosols. Cosidering this
example is intended to be pedagocical for introducing causal theory
to the readers, we will continue with the graph as drawn in Figure
xx. Causal graphs are very useful tools because they can be drawn
by any domain expert with no required knowledge of math or
probability, but they also represent formal mathetmical objects
with very sepcific meanings (discuss factorization of joint?).

% intro identification}

Given their mathematical meaning, we can use causal graphs to
identifiy which distributions we must estimate from data in order
to calcualte a causal effect of itnerest. This process of
identifying the necessary distributions is formally termed
\emph{causal indentification}. If a causal effect is not
identifiable (/un/identifiable), for example if
calculating a causal effect requires distributions of variables
that we do not observe, then we cannot use causal inference to
caluclate a causal effect, even with an infinite sample of data.

% backdoor path}

An early, well studied and relevant (to climate science)
sufficient condition for identificatication is called the
\emph{backdoor criterion}. The backdoor criterion states that if we can
observe variables such that the backdoor paths from cause to
effect are blocked, then a causal effect is identified. Backdoor
paths are any paths going through parents of the cause, to the
effect. We can block these paths by selectively observing
variables such that no information passes through them. Perhaps
more intuition can be gained by considering a mutilated causal
graph where we remove all edges from the cause to the cause's
children, and then ask the question, "is the cause independent of
the effect?" in the mutilated graph. If the answer is yes, then
calcuating our causal effect is identified. If the answer is no,
then we must observe some variables such that the cause becomes
independent of the effect, in the mutilated graph. This matches
intuition: we only want to calculate the co-variability of our
cause and effect due to information travelling from the cause to
the effect along directed causal pathways, not due to the cause's
parent processes inducing covariability in both the cause and
effect. In other words, in the absence of backdoor paths,
correltion is causation.

% backdoor path with example}

Perhaps backdoor paths and the backdoor criterion are better
introduced with an example. Returning to out toy example Figure
xx, we will attempt to calcualte the causal effect of clouds on
sunlight. In otherwords, we want to isolate the variability of
sunlight due to the causal link from cloud to sunight. However,
aerosols both effect cloud (edge from aerosol to cloud), and
sunlight, so if we naively calculate a causal effect, for example
by just regressing sunlight on cloud, we would get a biased
estimate of the mean causal effect of cloud on sunlight. This can
be shown graphically if we remove all edges from our cause (cloud)
to children of our cause (in this case sunlight) (Figure xx). We
see that cloud is not indepednent of aerosol in the mutilated
graph. How would we make cloud and sunlight independent in this
mutiliated graph? In this case, by observing
aerosol. Mathematically, the identification of the causal effect
of cloud and aerosol accoridng to the backdoor criterion is:

\begin{equation}
  P(sunlight | do(cloud) = c) = \int_{aerosol} p(sunlight| cloud = c,
  aerosol) p(aerosol)),
\end{equation}

\emph{introduce ATE?}

where we have implicitly introduced Pearl's "do" calculus, which
just means we want to calculate the effect of ("doing") an
intervention on the cause (in this case cloud) and setting it to
some value of our choosing (in this cas \(c\)). In the case that
observations of aerosols are not available, our causal effect is
not identifiable and we cannot use causal inference no matter how
large the sampel sizes of clouds and aerosols. This theory is an
elegant tool: without having to touch data or estimate marginal or
conditional distributions, we can determine whether it is possible
to calculate a causal effect of interest. We later use this thoery
to theoretically assess which general problems are tractable in
earth science using causal inference.

% other identification strategies focusing on backdoor path}

Here we focus on the backdoor criterion. However, other
identification stregies exist, primarily the front-door criterion
and instrument variables. Given that the front-door criterion can
be reformulated as a specific case of the back-door criterion
(cite XX?), and that applying instrument variables to a system
with an evolving state space is challenging (cite XX? - also
discuss how in practice intrument variables can introduce
biases? - see sSHalizi). However please consult citeXX and cite
XXX for more information on the front-door criterion and
instrument variables.

\subsection{Clarification on terminology and relationship to literature on causal discovery}

% causal discovery = infering causal graph from data}

In this paper we discuss causal inference, and define it as
estimating the induced effect of intervening on a cause (setting
it or changing it to some value). However "causal inference" has
also been used previously to describe the process of inferring the
graph strucutre of a causal graph from data. To be consisstent
with previous literature in the causal community, we call this
technique of of infering the graph structure from data \emph{causal
structure discovery}, whiel calculating causal effects given a
graph and data is \emph{causal inference}. There has been cosiderable
recent focus on \emph{causal structure discovery} in earth science, so
it is worthwhile to discuss the relationship between causal
inference and causal discovery and how it relates to earth science.

% often times we know causal graph (can write down equations)}

Often in earth science we know or have a strong a priori belief
about the causal graph of our system. For example, in the climate
system we can identify the state variables and we know that the
state at time \(t\) determnines the state at time \(t+1\), even if we
might not be able to write down the exact functional form of this
state evolution. Therefor, we can write down a causal graph and do
not need to infer graph structrue from data.  So, why the itnerest
in causal discovery for earth science? One possible explanation is
that causal discovery may be useful to remove edges that have a
small or negligble effect. Some portions of the climate state at
time \(t\) may have a negligble effect on other portions of the
climate state at time \(t+1\), and causal discovery could eliminate
edges between these portions of the state space.  Additionally,
while we can usually derive a causal graph of an earth science
system using expert knowledge for physical variables, we may not
be able to do so for transformed or reduced-dimension derived
quantities. Causal discovery methods can be applied to identify
causal dependencies between between these derived variables.

% resulting causal graph will be function of significance paramters}

However, causal discovery algorithms rely on significance
parameters used to determine conditoinal independence between
variables. Because causal discovery algorhtms can produce
potentially arbitraty results as a function of hyperparameters
(significance levels) of the method, it may be methodloically
safer to build a causal graph using expert knowledge, even if this
limits us to scenarios where we know the causal structure (in
physical sciences this may not be so limiting). It is still
possible to test that the causal sgraph is consistent with
observations using conditional independence tests, so we can still
verify some of the assumptions in a causal graph.

% many pitfalls of causal discovery same as for causal inference}

Finally, many pitfalls of causal discovery are similiar for causal
inference. In particular, applying causal discovery algorithms on
a system with only partial overservations of the presents
significant unresolved problems and challenges (cite XX). Given
that we often know the causal structure of our system through well
studied physics and dynamics, we believe there is a lot of
potential for using causal inference. Given this motivation we
focus the rest of our discussion on the problems for which causal
inference is tractable in earth science.

 % put in this section? think important to discuss regression and
 % problems of conditioning on variables that are in the causal path.
 % ** Causal graphs: a tool for communicating assumptions and avoiding flawed experiments
 % *** A tool for communicating assumptions
 % *** Avoiding flawed experiment designs

\subsection{Applications in earth science: pitfalls and justified
  approaches for generic scenarios}


\subsubsection{Causal identification when the state space is known}
% reorganize as: what does it take to block backdoor paths. okay, what
% about the fact that we partially observe state space?

% also, start with discussing internal to the system, then bring up how
% we might be able to get away with assuming soem pieces are external to
% the system

% Earth science as a dynamical system with partial observations of the state space}

Earth science systems can be viewed as a stochastic dynamical system
evolving through time according to an underlying state stace. This
offers both advantages and challenges for causal inference. Challenges
involve estimating the state space from observations, while advantages
include the temporal ordering of events; we know that future events
can have no causal effect on the past.

Fist we conisder a generic scenario in a simple temporal system with
no spatial comonent, where we are interested in the causal effect of
$C(t)$ on $E(t+1)$, where $C$ and $E$ are processes within the larger
system's state $S$. We denote the portion of the state space excluding
$C$ and $E$ as $S'$. $C(t)$, $E(t)$, and $S'(t)$ all affect $C(t+1)$,
$E(t+1)$ and $S'(t+1)$ (figure XX). In order to calculate the causal
effect of $C(t)$ on $E(t+1)$, we must block all back door paths from
$C(t)$ to $E(t+1)$. In this generic scenario, this involves
conditioning on $S'(t)$ and $E(t)$:

\begin{equation}
  \label{naive}
  P(E(t+1)| do(C(t))) = \int_{S'(t)} \int_{E(t)} p(E(t+1) | C(t), S'(t),
  E(t)) \; p(E(t)) \; p(S'(t))
\end{equation}

However, we never fully observe the state of the system. So, $S'(t)$
is is not directly observed. We may, however, be able to estimate
$S'(t)$ by leveraging Takens's theorem and using lagged observations
of the partial state space, going back in time (e.g. $S(t-1)$,
$S(t-2)$, etc.). In this application, this approach presents
problems. The reconstruction will estimate $S$ rather than $S'$, which
inlcudes $C(t)$ because $C$ is a part of the state space. Fortunately,
we can also block backdoor paths by conditioning on $S(t-1)$. If we
reconstruct $S(t-1)$ using lagged observations before $t-1$, we can
block backdoor paths and calculate a causal effect. So, the more
tractable approach to blocking backdoor paths in the earth system,
where we only ever partially observe the state space, is:

\begin{equation}
  \label{ce}
  P(E(t+1)| do(C(t))) = \int_{S(t-1)} \int_{E(t)} p(E(t+1) | C(t), S(t-1),
  E(t)) \; p(E(t)) \; p(S(t-1)),
\end{equation}

where $S(t-1)$ is statistically reconstructed using lagged
observations of the partial state space (justified by Takens's
theorem).

To extend this result on a purely temporal dyanmical system to a
spatio-temporal system, we use the idea of lightcones
\citep{PhysRevLett.84.1890,
  montanez2015licors,doi:10.1063/1.5021130}. Lightcones leverage our
general knowledge or assumptions about the speed with with the
influence of events can propagate through the system. For a general
physical system, an upper limit on the propagation speed is the speed
of light. For that atmosphere, a useful upper limit is the speed of
sound. However, in many scenarios (e.g. if we do not care about the
effect of soundwaves), we can use a more reasonalbe speed of
propagation like the advection (wind) speed, or the phase/group speed
of gravity waves. We can use the propagation speed of the system to
analyze what portions of the state space can or cannot affect an event
at a given time and spatial extent. The past lightcones are the set of
all events in a spatiotemporal system that can \textit{affect} a
single event at a given location and time. The future lightcones are
the set of all events in a sptiotemporal system that are
\textit{affected by} an event at a given location and time. We can use
the past lightcones of our cause and out effect to determine the
spatio-temporal locations we must use to estimate $S(t-1)$ and block
backdoor paths.

An example will help. Consider a scenario where half-hourly
observations are available, we assume the propagation speed is
$25 m/s$, and that we are interested in the affect of
$C(x=0 m, y=0 m, t=0 hr)$ on $E(x=0, y=0, t=0.5 hr)$. In this case, we
would need to estimate $S(t=-1 hr)$, over all locations that could
affect \emph{both} $C(0,0,0)$ and $E(0,0,0.5)$.  For a propagation
speed of $25 m/s$, this requires esimating the state over a circular
area centered at $x=0$, $y=0$, and with a radius
$25 \, m/s \cdot 1800 \, s = 45 km$. However, becuse we only partially
observe the state space, we must use lagged observations going back in
time, inlcluding all observations of events within the past lightcone
of the system. For example, at $-1$ hours our circular radius would be
90 km, at $-1.5$ hr: 135 km, and at $-2$ hr: 180 km. As one can
observe, the problem because stastically and computationally harder
the more lags are required to estimate are state space. If the number
of lags in inversly proportional to the obsevational coverage of the
state space, this motivates more observations of the earth system!

/where to put stuff about software I wrote?/

In practice we do not know how many lagged observations of the state
space we need to reconstruct it at time $t-1$. One possible approach
is to use the data for guidance: we will have fully reconstructed the
state space when the addition of more time lags does not imporve our
prediciton of our effect at time \(t+1\) (or cause at time $t$).


\paragraph{Applications on the human-earth system interface}

One particularly tractable approach that avoids estimating the full
state space of our system at a given time, is when our causes of
interest are independent from the evolution of the state space. While
the earth system certainly affects all objects living on earth, in
some cases this may be a reasonable assumption. For example, it is
tragic but unfortunately recent human history has demonstrated that
our global actions are relatively independent of the climate
state. That is, we have failed to reduce green house gas emissions
even as global temperature increased. When global green house gas
emissions have risen less sharply, it is usually due to global
economic recession (cite xx, 2008). In this case it appears that the
many global social, policital and economic factors are primary causes
of global green house gas emission, and while the climate system may
effect this forces, the historical evedence suggests that an
assumption that global green house gas emission is independent fo the
climate may be reasonable, at least for the present and near future
\emph{discuss data problem - we know don't observe the future of green
  house gas emissions}.

Generally this logic applies to many scenarios on the
"human-climate" interface. For example, land-use land-cover change
can be viewed in many scnearios independent of the climate system,
as in urban centers where urban planning is relatively independent
fo recent climate history. We encode a general graph of the
assumption that causes are independent of the state space,
reflecting our general suggestion that the human-climate interface
may be a particularly common example of this scenario.



\subsection{Discussion}

discuss transportability?

discuss relationship of these ideas to causal discovery (critique
causal discovery)?

discuss issues with data available and observed range
(e.g. generalization for cliamte research)?

\bibliography{references.bib}

\end{document}